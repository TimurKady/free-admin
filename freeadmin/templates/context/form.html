{% extends "layout/section.html" %}

{% block head %}
  {{ super() }}
  {% for href in assets.css %}
  <link rel="stylesheet" href="{{ href }}">
  {% endfor %}
{% endblock %}

{% block section_body %}
  <section class="d-flex flex-column w-100 h-100">
    <h2>{{ page_title }}</h2>
    <div id="form-spinner" class="text-center my-4">
      <div class="spinner-border" role="status"></div>
    </div>
    <div id="form-root" class="flex-grow-1 overflow-auto" style="min-height: 0;"></div>
    <div id="inline-root" class="mt-3" hidden>
      <!-- JS renders inline cards here -->
    </div>

    <!-- buttons -->
    <div class="d-flex gap-2 justify-content-end bg-light border rounded-2 mt-2 p-2">
      <button id="submit" class="btn btn-primary">Save</button>
      <button class="btn btn-secondary">Cancel</button>
    </div>
  </section>
{% endblock %}

{% block scripts %}
  {{ super() }}
  {% for src in assets.js %}
  <script src="{{ src }}"></script>
  {% endfor %}
  <script src="{{ prefix }}/static/admin-form.js"></script>
  <script src="{{ prefix }}/static/vendors/json-editor/dist/jsoneditor.min.js"></script>
  <script>
    if (window.ace?.config?.set) {
      window.ace.config.set("basePath", "{{ prefix }}/static/vendors/ace-builds/src-noconflict/");
    }
  </script>
  <script>
    const sectionPrefix = "{{ prefix }}{% if section_mode == 'settings' %}{{ SETTINGS_PREFIX }}{% else %}{{ ORM_PREFIX }}{% endif %}";
    (window.JSONEditorInitializer?.ready || Promise.resolve()).then(() => {
      window._form = new AdminFormEditor({ pk: "{{ pk or '' }}", prefix: sectionPrefix });
      window._form.load();
    });
  </script>
  <script>
    (function(){
      const usp = new URLSearchParams(location.search);
      const next = usp.get('next');
      const cancelBtn = document.querySelector('button.btn.btn-secondary');
      if (cancelBtn) {
        cancelBtn.onclick = function(){
          if (next) { location.href = next; }
          else { history.back(); }
        };
      }
    })();
  </script>
{% endblock %}

<!-- # The End -->

